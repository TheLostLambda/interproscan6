params {
    ipsc_version = '6.0.0'
    applications = 'AntiFam,CDD,FunFam,Gene3D,HAMAP,NCBIfam,Panther,Pfam,PIRSF,PROSITE_PATTERNS,PROSITE_Profiles,SFLD,SMART,SUPERFAMILY'
    batchsize = 500
    disable_precalc = false
    formats = 'json,tsv,xml'
    goterms = true
    help = false
    input = null
    nucleic = false
    output = 'results/output'
    pathways = true
    translate {
        strand = 'both'
        methionine = false
        min_len = 30
        genetic_code = 1
    }
    version = false
}

trace {
    enabled = true
    fields = 'task_id,process,realtime,duration,status,cpus,%cpu,time,memory,%mem,rss,peak_rss,submit,start,complete,queue'
    file = 'ips6.trace.txt'
    overwrite = true   
}

errorStrategy = { task.exitStatus in [143,137,104] && task.attempt <= 3 ? 'retry' : 'finish' }

profiles {

    local {
        process.executor = 'local'
        process.memory = { 1.GB * task.attempt }
        process.time = { 1.hour * task.attempt }
    }

    slurm {
        process.executor  = {
            name = "slurm"
            queueSize = 2000
            submitRateLimit = "10/1sec"
            exitReadTimeout = "30 min"
            jobName = {
                task.name // [] and " " may not be allowed in job names
                    .replace("[", "(")
                    .replace("]", ")")
                    .replace(" ", "_")
            }
            submitRateLimit = 100
            queueGlobalStatus = true
        }
        process.memory = { 2.GB * task.attempt }
        process.time = { 1.hour * task.attempt }
        process.maxRetries = 3
        process.errorStrategy = { ( task.exitStatus == 0 ) ? "retry" : "terminate" }
        process.afterScript = "sleep 60"
    }

    docker {
        process.container = 'interproscan6'
        process {
            withLabel:mobidb_runner {container = 'docker.io/library/idrpred'}
            withLabel:signalp_runner {container = 'docker.io/library/signalp6'}
        }
        docker.enabled = true
        docker.mountFlags = 'Z'
    }

    singularity {
        process.container = 'interproscan6.img'
        process {
            withLabel:'analysis_parser|get_orfs|io' {
                container = 'interproscan6.img'
                memory = { 6.GB * task.attempt }
                time = { 2.hour * task.attempt }
            }
            withLabel:mobidb_runner {
                container = 'idpred.img'
                memory = { 6.GB * task.attempt }
                time = { 2.hour * task.attempt }
            }
            withLabel:signalp_runner {
                container = 'signalp6.img'
                memory = { 6.GB * task.attempt }
                time = { 2.hour * task.attempt }
            }
        }
        singularity.enabled = true
        singularity.pullTimeout = "3 hours"
        singularity.cacheDir = "/hps/software/users/agb/interpro/ehobbs/nextflow_software_cache/singularity"
    }

}

includeConfig 'interproscan/subworkflows/sequence_precalc/lookup.config'
includeConfig 'interproscan/subworkflows/sequence_analysis/members.config'
includeConfig 'interproscan/subworkflows/xrefs/xrefs.config'
